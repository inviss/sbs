<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="MetadatMst">
	<typeAlias alias="MetadatMst" type="com.sbs.das.dto.MetadatMstTbl"/>
        
    <resultMap id="MetadatMstMap" class="MetadatMst">
		<result property="masterId" column="MASTER_ID" />
		<result property="pgmId" column="PGM_ID" />
		<result property="pgmCd" column="PGM_CD" />
		<result property="episNo" column="EPIS_NO" />
		<result property="title" column="TITLE" />
		<result property="ctgrLCd" column="CTGR_L_CD" />
		<result property="ctgrMCd" column="CTGR_M_CD" />
		<result property="ctgrSCd" column="CTGR_S_CD" />
		<result property="brdDd" column="BRD_DD" />
		<result property="finalBrdYn" column="FINAL_BRD_YN" />
		<result property="snps" column="SNPS" />
		<result property="keyWords" column="KEY_WORDS" />
		<result property="brdBgnHms" column="BRD_BGN_HMS" />
		<result property="brdEndHms" column="BRD_END_HMS" />
		<result property="brdLeng" column="BRD_LENG" />
		<result property="pgmRate" column="PGM_RATE" />
		<result property="drtNm" column="DRT_NM" />
		<result property="producerNm" column="PRODUCER_NM" />
		<result property="writerNm" column="WRITER_NM" />
		<result property="prdtInOutsCd" column="PRDT_IN_OUTS_CD" />
		<result property="prdtDeptCd" column="PRDT_DEPT_CD" />
		<result property="prdtDeptNm" column="PRDT_DEPT_NM" />
		<result property="orgPrdrNm" column="ORG_PRDR_NM" />
		<result property="mcNm" column="MC_NM" />
		<result property="castNm" column="CAST_NM" />
		<result property="cmrDrtNm" column="CMR_DRT_NM" />
		<result property="fmDt" column="FM_DT" />
		<result property="cmrPlace" column="CMR_PLACE" />
		<result property="spcInfo" column="SPC_INFO" />
		<result property="reqCd" column="REQ_CD" />
		<result property="secArchNm" column="SEC_ARCH_NM" />
		<result property="secArchId" column="SEC_ARCH_ID" />
		<result property="gathCoCd" column="GATH_CO_CD" />
		<result property="gathClfCd" column="GATH_CLF_CD" />
		<result property="archRegDd" column="ARCH_REG_DD" />
		<result property="arrgEndDt" column="ARRG_END_DT" />
		<result property="workPrioCd" column="WORK_PRIO_CD" />
		<result property="rsvPrdCd" column="RSV_PRD_CD" />
		<result property="cprtrNm" column="CPRTR_NM" />
		<result property="cprtType" column="CPRT_TYPE" />
		<result property="cprtTypeDsc" column="CPRT_TYPE_DSC" />
		<result property="viewGrCd" column="VIEW_GR_CD" />
		<result property="dlbrCd" column="DLBR_CD" />
		<result property="awardHstr" column="AWARD_HSTR" />
		<result property="rpimgKfrmSeq" column="RPIMG_KFRM_SEQ" />
		<result property="tapeId" column="TAPE_ID" />
		<result property="tapeItemId" column="TAPE_ITEM_ID" />
		<result property="tapeMediaClfCd" column="TAPE_MEDIA_CLF_CD" />
		<result property="rsvPrdEndDd" column="RSV_PRD_END_DD" />
		<result property="delDd" column="DEL_DD" />
		<result property="useYn" column="USE_YN" />
		<result property="regrid" column="REGRID" />
		<result property="regDt" column="REG_DT" />
		<result property="modrid" column="MODRID" />
		<result property="modDt" column="MOD_DT" />
		<result property="gathDeptCd" column="GATH_DEPT_CD" />
		<result property="mcuid" column="MCUID" />
		<result property="rpimgCtId" column="RPIMG_CT_ID" />
		<result property="dataStatCd" column="DATA_STAT_CD" />
		<result property="ingRegDd" column="ING_REG_DD" />
		<result property="copyKeep" column="COPY_KEEP" />
		<result property="cleanKeep" column="CLEAN_KEEP" />
		<result property="musicInfo" column="MUSIC_INFO" />
		<result property="rstCont" column="RST_CONT" />
		<result property="rerun" column="RERUN" />
		<result property="acceptorId" column="ACCEPTOR_ID" />
		<result property="subTtl" column="SUB_TTL" />
		<result property="arrangeNm" column="ARRANGE_NM" />
		<result property="lockStatCd" column="LOCK_STAT_CD" />
		<result property="errorStatCd" column="ERROR_STAT_CD" />
		<result property="archRoute" column="ARCH_ROUTE" />
		<result property="pdsCmsPgmId" column="PDS_CMS_PGM_ID" />
		<result property="ristClfCd" column="RIST_CLF_CD" />
		<result property="acceptEndDd" column="ACCEPT_END_DD" />
		<result property="tcStat" column="TC_STAT" />
		<result property="manualYn" column="MANUAL_YN" />
		<result property="chennelCd" column="CHENNEL_CD" />
		<result property="cocd" column="COCD" />
		<result property="artist" column="ARTIST" />
		<result property="countryCd" column="COUNTRY_CD" />
		<result property="errorId" column="ERROR_ID" />
		<result property="errorDt" column="ERROR_DT" />
    </resultMap>
    
    <resultMap id="MetadatMstFindMap" class="MetadatMst">
		<result property="masterId" column="MASTER_ID" />
		<result property="pgmCd" column="PGM_CD" />
		<result property="episNo" column="EPIS_NO" />
		<result property="title" column="TITLE" />
		<result property="brdDd" column="BRD_DD" />
		<result property="brdBgnHms" column="BRD_BGN_HMS" />
		<result property="brdEndHms" column="BRD_END_HMS" />
		<result property="duration" column="DURATION" />
		<result property="chennelCd" column="CHENNEL_CD" />
    </resultMap>
    
    <select id="findMetadatMst" resultMap="MetadatMstFindMap" parameterClass="map">
	     SELECT
			mst.MASTER_ID, mst.CHENNEL_CD, value(mst.PGM_CD, '') AS pgm_cd, VALUE(mst.EPIS_NO, 0) AS epis_no, mst.BRD_DD, 
			RTRIM(VALUE(mst.BRD_BGN_HMS, '0')) as BRD_BGN_HMS, RTRIM(VALUE(mst.BRD_END_HMS, '0')) as BRD_END_HMS,
		    case WHEN mst.CTGR_L_CD = '200' AND VALUE(pgm.PGM_ID, 0) > 0 THEN pgm.PGM_NM ELSE mst.TITLE END title, mst.PGM_CD, ct.DURATION
		 FROM METADAT_MST_TBL mst
			inner JOIN (
		    	SELECT master_id, ct_id FROM CONTENTS_MAPP_TBL WHERE VALUE(del_dd, '') = '' AND VALUE(del_yn, 'N') = 'N' GROUP BY master_id, ct_id
		    ) mapp ON mst.MASTER_ID = mapp.MASTER_ID
			inner JOIN CONTENTS_TBL ct ON mapp.CT_ID = ct.CT_ID
		    left outer JOIN PGM_INFO_TBL pgm ON mst.PGM_ID = pgm.PGM_ID
         <dynamic prepend="WHERE">
	         <isNotEmpty prepend="AND" property="brdDd">
		         mst.BRD_DD = #brdDd#
	         </isNotEmpty>
	         <isNotEmpty prepend="AND" property="brdBgnHms">
	         <![CDATA[
		         mst.BRD_BGN_HMS >= #brdBgnHms#
		     ]]>
	         </isNotEmpty>
	         <isNotEmpty prepend="AND" property="brdEndHms">
	         <![CDATA[
		         mst.BRD_END_HMS <= #brdEndHms#
		     ]]>
	         </isNotEmpty>
	         AND ct.CT_TYP = '003' 
         </dynamic>
         <isEqual property="wait" compareValue="true">
         	with UR
         </isEqual>
    </select>
   
	<select id="getMetadatMst" resultMap="MetadatMstMap" parameterClass="map">
		SELECT 
			MASTER_ID,
			PGM_ID,
			PGM_CD,
			EPIS_NO,
			TITLE,
			CTGR_L_CD,
			CTGR_M_CD,
			CTGR_S_CD,
			BRD_DD,
			FINAL_BRD_YN,
			SNPS,
			KEY_WORDS,
			BRD_BGN_HMS,
			BRD_END_HMS,
			BRD_LENG,
			PGM_RATE,
			DRT_NM,
			PRODUCER_NM,
			WRITER_NM,
			PRDT_IN_OUTS_CD,
			PRDT_DEPT_CD,
			PRDT_DEPT_NM,
			ORG_PRDR_NM,
			MC_NM,
			CAST_NM,
			CMR_DRT_NM,
			FM_DT,
			CMR_PLACE,
			SPC_INFO,
			REQ_CD,
			SEC_ARCH_NM,
			SEC_ARCH_ID,
			GATH_CO_CD,
			GATH_CLF_CD,
			ARCH_REG_DD,
			ARRG_END_DT,
			WORK_PRIO_CD,
			RSV_PRD_CD,
			CPRTR_NM,
			CPRT_TYPE,
			CPRT_TYPE_DSC,
			VIEW_GR_CD,
			DLBR_CD,
			AWARD_HSTR,
			RPIMG_KFRM_SEQ,
			TAPE_ID,
			TAPE_ITEM_ID,
			TAPE_MEDIA_CLF_CD,
			RSV_PRD_END_DD,
			DEL_DD,
			USE_YN,
			REGRID,
			REG_DT,
			MODRID,
			MOD_DT,
			GATH_DEPT_CD,
			MCUID,
			RPIMG_CT_ID,
			DATA_STAT_CD,
			ING_REG_DD,
			COPY_KEEP,
			CLEAN_KEEP,
			MUSIC_INFO,
			RST_CONT,
			RERUN,
			ACCEPTOR_ID,
			SUB_TTL,
			ARRANGE_NM,
			LOCK_STAT_CD,
			ERROR_STAT_CD,
			ARCH_ROUTE,
			PDS_CMS_PGM_ID,
			RIST_CLF_CD,
			ACCEPT_END_DD,
			TC_STAT,
			MANUAL_YN,
			CHENNEL_CD,
			COCD,
			ARTIST,
			COUNTRY_CD,
			ERROR_ID,
			ERROR_DT
		 FROM METADAT_MST_TBL
         <dynamic prepend="WHERE">
         	 <isNotEmpty prepend="AND" property="masterId">
		         MASTER_ID = #masterId#
	         </isNotEmpty>
		 </dynamic>
         <isEqual property="wait" compareValue="true">
         	with UR
         </isEqual>
    </select>
    
    <update id="updateMetadatMst" parameterClass="MetadatMst">
    	UPDATE METADAT_MST_TBL set USE_YN = #useYn#
		<isNotNull prepend="," property="pgmId">PGM_ID=#pgmId#</isNotNull>
		<isNotNull prepend="," property="pgmCd">PGM_CD=#pgmCd#</isNotNull>
		<isNotNull prepend="," property="episNo">EPIS_NO=#episNo#</isNotNull>
		<isNotNull prepend="," property="title">TITLE=#title#</isNotNull>
		<isNotNull prepend="," property="ctgrLCd">CTGR_L_CD=#ctgrLCd#</isNotNull>
		<isNotNull prepend="," property="ctgrMCd">CTGR_M_CD=#ctgrMCd#</isNotNull>
		<isNotNull prepend="," property="ctgrSCd">CTGR_S_CD=#ctgrSCd#</isNotNull>
		<!-- 
		<isNotNull prepend="," property="brdDd">BRD_DD=#brdDd#</isNotNull>
		-->
		<isNotNull prepend="," property="finalBrdYn">FINAL_BRD_YN=#finalBrdYn#</isNotNull>
		<isNotNull prepend="," property="snps">SNPS=#snps#</isNotNull>
		<isNotNull prepend="," property="keyWords">KEY_WORDS=#keyWords#</isNotNull>
		<!--  
		<isNotNull prepend="," property="brdBgnHms">BRD_BGN_HMS=#brdBgnHms#</isNotNull>
		<isNotNull prepend="," property="brdEndHms">BRD_END_HMS=#brdEndHms#</isNotNull>
		<isNotNull prepend="," property="brdLeng">BRD_LENG=#brdLeng#</isNotNull>
		-->
		<isNotNull prepend="," property="pgmRate">PGM_RATE=#pgmRate#</isNotNull>
		<isNotNull prepend="," property="drtNm">DRT_NM=#drtNm#</isNotNull>
		<isNotNull prepend="," property="producerNm">PRODUCER_NM=#producerNm#</isNotNull>
		<isNotNull prepend="," property="writerNm">WRITER_NM=#writerNm#</isNotNull>
		<isNotNull prepend="," property="prdtInOutsCd">PRDT_IN_OUTS_CD=#prdtInOutsCd#</isNotNull>
		<isNotNull prepend="," property="prdtDeptCd">PRDT_DEPT_CD=#prdtDeptCd#</isNotNull>
		<isNotNull prepend="," property="prdtDeptNm">PRDT_DEPT_NM=#prdtDeptNm#</isNotNull>
		<isNotNull prepend="," property="orgPrdrNm">ORG_PRDR_NM=#orgPrdrNm#</isNotNull>
		<isNotNull prepend="," property="mcNm">MC_NM=#mcNm#</isNotNull>
		<isNotNull prepend="," property="castNm">CAST_NM=#castNm#</isNotNull>
		<isNotNull prepend="," property="cmrDrtNm">CMR_DRT_NM=#cmrDrtNm#</isNotNull>
		<isNotNull prepend="," property="fmDt">FM_DT=#fmDt#</isNotNull>
		<isNotNull prepend="," property="cmrPlace">CMR_PLACE=#cmrPlace#</isNotNull>
		<isNotNull prepend="," property="spcInfo">SPC_INFO=#spcInfo#</isNotNull>
		<isNotNull prepend="," property="reqCd">REQ_CD=#reqCd#</isNotNull>
		<isNotNull prepend="," property="secArchNm">SEC_ARCH_NM=#secArchNm#</isNotNull>
		<isNotNull prepend="," property="secArchId">SEC_ARCH_ID=#secArchId#</isNotNull>
		<isNotNull prepend="," property="gathCoCd">GATH_CO_CD=#gathCoCd#</isNotNull>
		<isNotNull prepend="," property="gathClfCd">GATH_CLF_CD=#gathClfCd#</isNotNull>
		<isNotNull prepend="," property="archRegDd">ARCH_REG_DD=#archRegDd#</isNotNull>
		<isNotNull prepend="," property="arrgEndDt">ARRG_END_DT=#arrgEndDt#</isNotNull>
		<isNotNull prepend="," property="workPrioCd">WORK_PRIO_CD=#workPrioCd#</isNotNull>
		<isNotNull prepend="," property="rsvPrdCd">RSV_PRD_CD=#rsvPrdCd#</isNotNull>
		<isNotNull prepend="," property="cprtrNm">CPRTR_NM=#cprtrNm#</isNotNull>
		<isNotNull prepend="," property="cprtType">CPRT_TYPE=#cprtType#</isNotNull>
		<isNotNull prepend="," property="cprtTypeDsc">CPRT_TYPE_DSC=#cprtTypeDsc#</isNotNull>
		<isNotNull prepend="," property="viewGrCd">VIEW_GR_CD=#viewGrCd#</isNotNull>
		<isNotNull prepend="," property="dlbrCd">DLBR_CD=#dlbrCd#</isNotNull>
		<isNotNull prepend="," property="awardHstr">AWARD_HSTR=#awardHstr#</isNotNull>
		<isNotNull prepend="," property="rpimgKfrmSeq">RPIMG_KFRM_SEQ=#rpimgKfrmSeq#</isNotNull>
		<isNotNull prepend="," property="tapeId">TAPE_ID=#tapeId#</isNotNull>
		<isNotNull prepend="," property="tapeItemId">TAPE_ITEM_ID=#tapeItemId#</isNotNull>
		<isNotNull prepend="," property="tapeMediaClfCd">TAPE_MEDIA_CLF_CD=#tapeMediaClfCd#</isNotNull>
		<isNotNull prepend="," property="rsvPrdEndDd">RSV_PRD_END_DD=#rsvPrdEndDd#</isNotNull>
		<isNotNull prepend="," property="modrid">MODRID=#modrid#</isNotNull>
		<isNotNull prepend="," property="modDt">MOD_DT=#modDt#</isNotNull>
		<isNotNull prepend="," property="gathDeptCd">GATH_DEPT_CD=#gathDeptCd#</isNotNull>
		<isNotNull prepend="," property="dataStatCd">DATA_STAT_CD=#dataStatCd#</isNotNull>
		<isNotNull prepend="," property="ingRegDd">ING_REG_DD=#ingRegDd#</isNotNull>
		<isNotNull prepend="," property="copyKeep">COPY_KEEP=#copyKeep#</isNotNull>
		<isNotNull prepend="," property="cleanKeep">CLEAN_KEEP=#cleanKeep#</isNotNull>
		<isNotNull prepend="," property="musicInfo">MUSIC_INFO=#musicInfo#</isNotNull>
		<isNotNull prepend="," property="rstCont">RST_CONT=#rstCont#</isNotNull>
		<isNotNull prepend="," property="rerun">RERUN=#rerun#</isNotNull>
		<isNotNull prepend="," property="acceptorId">ACCEPTOR_ID=#acceptorId#</isNotNull>
		<isNotNull prepend="," property="subTtl">SUB_TTL=#subTtl#</isNotNull>
		<isNotNull prepend="," property="arrangeNm">ARRANGE_NM=#arrangeNm#</isNotNull>
		<isNotNull prepend="," property="lockStatCd">LOCK_STAT_CD=#lockStatCd#</isNotNull>
		<isNotNull prepend="," property="errorStatCd">ERROR_STAT_CD=#errorStatCd#</isNotNull>
		<isNotNull prepend="," property="archRoute">ARCH_ROUTE=#archRoute#</isNotNull>
		<isNotNull prepend="," property="pdsCmsPgmId">PDS_CMS_PGM_ID=#pdsCmsPgmId#</isNotNull>
		<isNotNull prepend="," property="ristClfCd">RIST_CLF_CD=#ristClfCd#</isNotNull>
		<isNotNull prepend="," property="acceptEndDd">ACCEPT_END_DD=#acceptEndDd#</isNotNull>
		<isNotNull prepend="," property="tcStat">TC_STAT=#tcStat#</isNotNull>
		<isNotNull prepend="," property="manualYn">MANUAL_YN=#manualYn#</isNotNull>
		<isNotNull prepend="," property="chennelCd">CHENNEL_CD=#chennelCd#</isNotNull>
		<isNotNull prepend="," property="cocd">COCD=#cocd#</isNotNull>
		<isNotNull prepend="," property="artist">ARTIST=#artist#</isNotNull>
		<isNotNull prepend="," property="countryCd">COUNTRY_CD=#countryCd#</isNotNull>
		<isNotNull prepend="," property="errorId">ERROR_ID=#errorId#</isNotNull>
		<isNotNull prepend="," property="errorDt">ERROR_DT=#errorDt#</isNotNull>
    	WHERE MASTER_ID = #masterId#
    </update>

 </sqlMap>